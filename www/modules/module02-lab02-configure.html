<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 2 - Configure Veeam Kasten :: Backup/DR/Mobility with Veeam Kasten</title>
    <link rel="prev" href="module02-lab01-pacman.html">
    <link rel="next" href="module02-lab03-backup-recovery.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank" style="margin-left: 5%;">
         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1008.5 178.739" style="width: 200px;"><g fill="#fff"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#fff"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#e00" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">One</tspan></text></svg>
      </a>
      <a class="navbar-item site-title" target="__blank" style="color: #fff !important;" href="..">Backup/DR/Mobility with Veeam Kasten</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item navbar-item-right-dropdown has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Links</a>
          <div class="navbar-dropdown navbar-dropdown-right">
            <a class="navbar-item navbar-item-right-content" href="https://redhat.com" target="_blank">Red Hat</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Backup/DR/Mobility with Veeam Kasten</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Veeam Kasten</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="module01-intro.html">Module 1 - Protecting Virtual Machines on OpenShift with Veeam Kasten</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab01-install.html">Installing Veeam Kasten</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab02-location-profile.html">Configuring Veeam Kasten for Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab03-backup-restore.html">Protecting Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab04-multicluster.html">Configuring Multi-Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab05-mobility.html">Migrating Workloads</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="module02-intro.html">Module 2 - Protecting Containerized Workloads with Veeam Kasten</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab01-pacman.html">Deploy a Sample Application</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="module02-lab02-configure.html">Configure Kasten for Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab03-backup-recovery.html">Backup and Recover our Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab04-blueprints.html">Provide Application Consistent Backups via Kasten Blueprints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Backup/DR/Mobility with Veeam Kasten</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Backup/DR/Mobility with Veeam Kasten</a></li>
    <li><a href="module02-intro.html">Module 2 - Protecting Containerized Workloads with Veeam Kasten</a></li>
    <li><a href="module02-lab02-configure.html">Configure Kasten for Backup</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 2 - Configure Veeam Kasten</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_1_configure_an_s3_compatible_object_store_for_backup">1. Configure an S3-compatible Object Store for Backup</a></li>
<li><a href="#_2_configuring_an_object_bucket_claim_to_store_backups">2. Configuring an Object Bucket Claim to Store Backups</a></li>
<li><a href="#_3_creating_an_s3_compatible_location_profile">3. Creating an S3-Compatible Location Profile</a></li>
<li><a href="#create-policy">4. Creating a Kasten Policy</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you have already configured an S3-compatible object store for Kasten and created a location profile in the previous Module, you can skip to <a href="#create-policy">4. Creating a Kasten Policy</a> using the Location Profile you created previously.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_configure_an_s3_compatible_object_store_for_backup"><a class="anchor" href="#_1_configure_an_s3_compatible_object_store_for_backup"></a>1. Configure an S3-compatible Object Store for Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Out of the box, Kasten provides everything required to perform a local snapshot of a Kubernetes application (It does require <em>k10.kasten.io/is-snapshot-class: "true"</em> is set on the VolumeSnapshotClass, which has already been done when the lab was provisioned) - <em>but snapshots are not backup!</em> In order to restore in the event the local cluster or primary storage is compromised, a copy of that data should be exported to another location.</p>
</div>
<div class="paragraph">
<p>The configuration of these backup targets are called <strong><em>Location Profiles</em></strong>.
Kasten <a href="https://docs.kasten.io/latest/usage/configuration.html">supports several options</a>, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS S3</p>
</li>
<li>
<p>Azure Blob</p>
</li>
<li>
<p>Google Cloud Storage</p>
</li>
<li>
<p>S3-Compatible</p>
</li>
<li>
<p>NFS</p>
</li>
<li>
<p>Veeam Backup &amp; Recovery</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kasten supports the creation of immutable backups to ensure that, as a last line of defense against ransomware, backup data cannot be manipulated or deleted by any user.
These backups are supported on the following platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS S3</p>
</li>
<li>
<p>S3-Compatible with Object Lock support (ex.
Ceph, MinIO, Wasabi, etc.)</p>
</li>
<li>
<p>Azure Blob</p>
</li>
<li>
<p>Google Cloud Storage</p>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><em>In this exercise, you will configure a bucket using the on-cluster Ceph Object Gateway deployment and add the bucket as a Location Profile in Kasten.</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
In a real world environment you should never back up data to the same infrastructure you are intending to protect - using on-cluster storage as a backup target is performed in the lab solely to simplify lab staging and instructions.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_configuring_an_object_bucket_claim_to_store_backups"><a class="anchor" href="#_2_configuring_an_object_bucket_claim_to_store_backups"></a>2. Configuring an Object Bucket Claim to Store Backups</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kasten supports immutable object storage and it is recommended to protect backups against accidental deletion or ransomware attack. For this lab, we won&#8217;t configure immutability as it requires elevated permissions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you haven&#8217;t yet logged into the <a href="https://console.example.com" target="_blank" rel="noopener">OpenShift console</a> log into the console now.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Your UserID is <code>user1</code> with password <code>redhat</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Open an OpenShift command line terminal</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/002.png" alt="002">
</div>
</div>
</li>
<li>
<p>An <code>ObjectBucketClaim</code> has already been created for you. You can examine the claim using the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe objectbucketclaim -n backuptarget-user1 kastenbackups-user1</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to retrieve the Access Key for the bucket:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get secret -n backuptarget-user1 kastenbackups-user1 \
  -o jsonpath='{.data.AWS_ACCESS_KEY_ID}' | base64 --decode && echo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the Access Key to a text editor as it will be needed again shortly</p>
</div>
</li>
<li>
<p>Run the following command to retrieve the Secret Key for the bucket:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get secret -n backuptarget-user1 kastenbackups-user1 \
 -o jsonpath='{.data.AWS_SECRET_ACCESS_KEY}' | base64 --decode && echo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the Secret Key to a text editor as it will be needed again shortly.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_creating_an_s3_compatible_location_profile"><a class="anchor" href="#_3_creating_an_s3_compatible_location_profile"></a>3. Creating an S3-Compatible Location Profile</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Kasten Dashboard</em></strong>, select <strong><em>Profiles → Location</em></strong> from the sidebar and click <strong><em>+ Add New</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/01.png" alt="01">
</div>
</div>
</li>
<li>
<p>Fill out the following fields and click <strong><em>Next</em></strong>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Location Profile Name</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kastenbackups-user1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Storage Provider</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 Compatible</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/02.png" alt="02">
</div>
</div>
</li>
<li>
<p>Fill out the following fields <strong><em>but DO NOT click Next yet!</em></strong>:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>S3 Access Key</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paste <code>ACCESS KEY</code> value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>S3 Secret</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paste <code>SECRET KEY</code> value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Endpoint</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Skip certificate chain and hostname verification</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Checked</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Region</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>us-east-1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Bucket</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kastenbackups-user1</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/02b.png" alt="02b">
</div>
</div>
</li>
<li>
<p>Click <strong><em>Next</em></strong> followed by <strong><em>Submit</em></strong> to create the Location Profile.</p>
<div class="paragraph">
<p>You should expect your <code>kastenbackups-user1</code> Location Profile to appear with a <strong><em>Success</em></strong> status.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/05.png" alt="05">
</div>
</div>
<div class="paragraph">
<p>Now you&#8217;re ready to start protecting apps!</p>
</div>
</li>
<li>
<p>Click the <strong><em>&#8230;&#8203;</em></strong> menu and select <strong><em>View YAML</em></strong> to view the manifest generated by creating a Location Profile through the Dashboard.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab02-location-profile/06.png" alt="06">
</div>
</div>
<div class="paragraph">
<p>As you can see from this example, Kasten Location Profiles can be created declaratively as a <code>profile.config.kio.kasten.io</code> object referencing a Secret to store access and secret keys.
This Kubernetes-native implementation makes it simple to configure backup targets using a GitOps approach.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See <a href="https://docs.kasten.io/latest/api/profiles.html">docs.kasten.io</a> for complete documentation on defining Profile API objects.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong><em>Cancel</em></strong> or the <strong><em>X</em></strong> in the upper-right to close the YAML window.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-policy"><a class="anchor" href="#create-policy"></a>4. Creating a Kasten Policy</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Kasten Dashboard</em></strong>, select <strong><em>Applications</em></strong> to view all discovered namespaces.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/07.png" alt="07">
</div>
</div>
<div class="paragraph">
<p>Your <code>kasten-lab-user1-pacman</code> application should appear as <strong><em>Unmanaged</em></strong>, indicating it is not being protected by any policy.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You will notice that you don&#8217;t see any namespaces starting with <code>openshift</code> in the list of applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Namespaces, including the <code>openshift-...</code> system namespaces can be excluded from the <strong><em>Applications</em></strong> list (and compliance reporting) by adding a list of <code>excludedApps</code> to the K10 Operand <code>spec</code>, as shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/08.png" alt="08">
</div>
</div>
<div class="paragraph">
<p>The following command can be used to produce a properly formatted list of namespaces beginning with <code>openshift</code> that can be copy/paste into the K10 Operand YAML tab:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ns --no-headers=true | \
  awk 'BEGIN { print "  excludedApps:" } /^openshift/{print "  -",$1}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your lab environment has already been configured to exclude system namespaces.</p>
</div>
</div>
</div>
</li>
<li>
<p>Click <code>kasten-lab-user1-pacman</code> in the <strong><em>Applications</em></strong> list to view details about the workloads and additional resources discovered within the namespace.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/09.png" alt="09">
</div>
</div>
</li>
<li>
<p>Close the <strong><em>Application Details</em></strong> window.</p>
</li>
<li>
<p>Under <code>kasten-lab-user1-pacman</code>, select <strong><em>&#8230;&#8203;
→ Create a Policy</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/10.png" alt="10">
</div>
</div>
</li>
<li>
<p>Leave the defaults for <strong><em>Name</em></strong> and <strong><em>Action</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/11.png" alt="11">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Policy Presets provide the option of allowing administrators to define SLA-focused configurations to simplify self-service data protection for other users.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Leave the default <strong><em>Hourly Backup Frequency</em></strong> and <strong><em>Snapshot Retention</em></strong> values.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/12.png" alt="12">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist NOTE">
<ul class="NOTE">
<li>
<p>Toggling <strong><em>Advanced Frequency Options</em></strong> allows users to specify what time hourly snapshots occur, how many snapshots to take per hour, and which snapshots should be used for daily, weekly, monthly, and yearly promotion.</p>
</li>
<li>
<p>Toggling <strong><em>Backup Window</em></strong> allows users to specify during what times is Kasten allowed to run the policy.</p>
</li>
<li>
<p>Enabling <strong><em>Use Staggering</em></strong> can intelligently distribute when to start policies during the specified window such that the desired frequency is maintained, but with the least amount of policies running simultaneously, allowing Kasten to reduce the peak load on the cluster.</p>
</li>
<li>
<p>These settings should be left unselected for this lab.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Toggle <strong><em>Enable Backups via Snapshot Exports</em></strong> and select <code>kastenbackups-user1</code> as the <strong><em>Export Location Profile</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/13.png" alt="13">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Kasten will export all data associated with the snapshot to ensure you have a durable, off-cluster copy.
However, there are circumstances where you may only want to export references to the snapshot, such as migrating a workload in AWS from one availability zone to another.
This ability to only export snapshot metadata can dramatically improve performance in these specific instances.
This can be configured under <strong><em>Advanced Export Settings</em></strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Under <strong><em>Select Applications</em></strong>, verify the <code>kasten-lab-user1-pacman</code> namespace has been selected.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/14.png" alt="14">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Targeting application(s) based on namespace is generally the most straightforward method of defining a backup policy.
However, Kasten also allows you to identify applications based on native Kubernetes labels.
This is especially helpful if you have many VMs in a single namespace and only want to protect current and <strong><em>future</em></strong> VMs with a specific label on the <code>VirtualMachine</code> resource, such as <code>backup: gold</code> or <code>vm: prod</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kasten also provides rich filtering capabilities to include or exclude resources based on Kubernetes <strong><em>API Group</em></strong>, <strong><em>API Version</em></strong>, <strong><em>Resource Type</em></strong>, <strong><em>Resource Name</em></strong>, and <strong><em>Labels</em></strong>.
For example, you could exclude backup for <strong><em>Secrets</em></strong> resources where a label includes an indication that the secret is externally managed.</p>
</div>
</div>
</div>
</li>
<li>
<p>Leave the remaining settings as default.</p>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When performing many tasks within the Kasten UI, you can press the <strong><em>&lt;/&gt; YAML</em></strong> button to expose the native Kubernetes YAML that defines the resource created through the UI.
This can be useful for familiarizing yourself with the Kubernetes-native APIs defined by Kasten and for extracting snippets for use in GitOps or Infrastructure-as-Code tools.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong><em>Create Policy</em></strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="module02-lab01-pacman.html" class="query-params-link">Deploy a Sample Application</a></span>
  <span class="next"><a href="module02-lab03-backup-recovery.html" class="query-params-link">Backup and Recover our Application</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
