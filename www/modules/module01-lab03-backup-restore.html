<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Protecting VMs :: Lab 15 - Backup/DR with Veeam Kasten K10</title>
    <link rel="prev" href="module01-lab02-location-profile.html">
    <link rel="next" href="module01-lab04-multicluster.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank" style="margin-left: 5%;">
         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1008.5 178.739" style="width: 200px;"><g fill="#fff"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#fff"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#e00" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">One</tspan></text></svg>
      </a>
      <a class="navbar-item site-title" target="__blank" style="color: #fff !important;" href="..">Lab 15 - Backup/DR with Veeam Kasten K10</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item navbar-item-right-dropdown has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Links</a>
          <div class="navbar-dropdown navbar-dropdown-right">
            <a class="navbar-item navbar-item-right-content" href="https://redhat.com" target="_blank">Red Hat</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Lab 15 - Backup/DR with Veeam Kasten K10</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Veeam Kasten</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#module01-intro.adoc">Module 1 - Protecting Virtual Machines on OpenShift with Veeam Kasten</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab01-install.html">Installing Veeam Kasten</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab02-location-profile.html">Configuring Veeam Kasten for Backups</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="module01-lab03-backup-restore.html">Protecting Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab04-multicluster.html">Configuring Multi-Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module01-lab05-mobility.html">Migrating Workloads</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#module02-intro.adoc">Module 2 - Protecting Containerized Workloads with Veeam Kasten</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab01-pacman.html">Deploy a Sample Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab02-backup-recovery.html">Backup and Recover our Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="module02-lab03-blueprints.html">Provide Application Consistent Backups via Kasten Blueprints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Lab 15 - Backup/DR with Veeam Kasten K10</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Lab 15 - Backup/DR with Veeam Kasten K10</a></li>
    <li><a href="#module01-intro.adoc">Module 1 - Protecting Virtual Machines on OpenShift with Veeam Kasten</a></li>
    <li><a href="module01-lab03-backup-restore.html">Protecting Virtual Machines</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Protecting VMs</h1>
<div class="sect1">
<h2 id="_1_introduction"><a class="anchor" href="#_1_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>In this exercise you will create and run a Kasten policy for protecting Virtual Machines running on OpenShift and test restoring from both local and remote backup sources.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_creating_a_vm"><a class="anchor" href="#_2_creating_a_vm"></a>2. Creating a VM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fist you will create a new VM in a new project to use for the exercise.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>OpenShift Console</em></strong>, navigate to <strong><em>Virtualization</em></strong> &#8594; <strong><em>Virtual Machines</em></strong>.</p>
</li>
<li>
<p>To create a new project to work in select the <strong><em>Project</em></strong> menu and click <strong><em>Create Project</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/01.png" alt="01">
</div>
</div>
</li>
<li>
<p>Specify <code>kasten-lab-user1</code> as the <strong><em>Name</em></strong> and click <strong><em>Create</em></strong>.</p>
</li>
<li>
<p>Select <strong><em>Virtualization → Virtual Machines</em></strong> from the sidebar, and click <strong><em>Create VirtualMachine → From template</em></strong> in the <code>kasten-lab-user1</code> Project.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/03.png" alt="03">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Kasten can be used to protect VMs provisioned using an <code>InstanceType</code> but currently requires a manual transform be applied during the restore process, which is out of the scope of this lab exercise.
Full support for <code>InstanceTypes</code> will be added in an upcoming release.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Under <strong><em>Template catalog</em></strong>, select the <code>fedora-server-small</code> template.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/04.png" alt="04">
</div>
</div>
</li>
<li>
<p>Update the <strong><em>VirtualMachine name</em></strong> to <code>fedora-k10</code> and click <strong><em>Quick create VirtualMachine</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/05.png" alt="05">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This will provision the VM with preferred storage settings for the <code>px-csi</code> StorageClass, specifically <strong><em>Block VolumeMode</em></strong> to provide the <strong><em>ReadWriteMany</em></strong> access required to enable live migration between OpenShift nodes.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Validate the <code>fedora-k10-volume</code> PersistentVolumeClaim configuration from <strong><em>Storage → PersistentVolumeClaims</em></strong> in the sidebar.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/06.png" alt="06">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_enabling_block_mode_exports"><a class="anchor" href="#_3_enabling_block_mode_exports"></a>3. Enabling Block Mode Exports</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As some storage provisioners may not fully support Block volume mode, StorageClasses should first be evaluated for compatibility <a href="https://docs.kasten.io/latest/operating/k10tools.html#k10-primer-block-mount-check">using the primer script</a>.
This is skipped in the lab exercise as the <code>openshift-storage.rbd.csi.ceph.com</code> provisioner is known to be compatible.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Your <code>StorageClass</code> has already been set up to allow the Kasten datamover to export raw Block volumes using the <code>px-csi</code> StorageClass:</p>
<div class="paragraph">
<p>In the <strong><em>Web Terminal</em></strong>, run the following command to validate that the annotation is present (you should see an annotation starting with <code>k10.kastion.io</code>):</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get sc px-csi -ojsonpath=='{.metadata.annotations}';echo</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The command to annotate the storage class would be (you don&#8217;t need to execute this):
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc annotate storageclass {kasten_storageclass} \
  k10.kasten.io/sc-supports-block-mode-exports=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Kasten provides an out-of-the-box, direct API integration with ODF&#8217;s Ceph Volume Manager for block data movement - including support for incremental backups to lower storage consumption requirements for protecting Virtual Machines.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
While many Kubernetes backup solutions can orchestrate local CSI snapshots of a <code>volumeMode: Block</code> PVC, it is important to remember that <em>snapshots do not equal backup</em> - and that having a backup solution that can provide off-cluster data movement for <code>volumeMode: Block</code> PVCs is critical.
Support for this capability does <strong>NOT</strong> exist in Velero or OADP today.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_creating_a_kasten_policy"><a class="anchor" href="#_4_creating_a_kasten_policy"></a>4. Creating a Kasten Policy</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Kasten Dashboard</em></strong>, select <strong><em>Applications</em></strong> to view all discovered namespaces.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/07.png" alt="07">
</div>
</div>
<div class="paragraph">
<p>Your <code>kasten-lab-user1</code> application should appear as <strong><em>Unmanaged</em></strong>, indicating it is not being protected by any policy.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You will notice that you don&#8217;t see any namespaces starting with <code>openshift</code> in the list of applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Namespaces, including the <code>openshift-...</code> system namespaces can be excluded from the <strong><em>Applications</em></strong> list (and compliance reporting) by adding a list of <code>excludedApps</code> to the K10 Operand <code>spec</code>, as shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/08.png" alt="08">
</div>
</div>
<div class="paragraph">
<p>The following command can be used to produce a properly formatted list of namespaces beginning with <code>openshift</code> that can be copy/paste into the K10 Operand YAML tab:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ns --no-headers=true | \
  awk 'BEGIN { print "  excludedApps:" } /^openshift/{print "  -",$1}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your lab environment has already been configured to exclude system namespaces.</p>
</div>
</div>
</div>
</li>
<li>
<p>Click <code>kasten-lab-user1</code> in the <strong><em>Applications</em></strong> list to view details about the workloads and additional resources discovered within the namespace.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/09.png" alt="09">
</div>
</div>
</li>
<li>
<p>Close the <strong><em>Application Details</em></strong> window.</p>
</li>
<li>
<p>Under <code>kasten-lab-user1</code>, select <strong><em>&#8230;&#8203;
→ Create a Policy</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/10.png" alt="10">
</div>
</div>
</li>
<li>
<p>Leave the defaults for <strong><em>Name</em></strong> and <strong><em>Action</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/11.png" alt="11">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Policy Presets provide the option of allowing administrators to define SLA-focused configurations to simplify self-service data protection for other users.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Leave the default <strong><em>Hourly Backup Frequency</em></strong> and <strong><em>Snapshot Retention</em></strong> values.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/12.png" alt="12">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Toggling <strong><em>Advanced Frequency Options</em></strong> allows users to specify what time hourly snapshots occur, how many snapshots to take per hour, and which snapshots should be used for daily, weekly, monthly, and yearly promotion.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Toggling <strong><em>Backup Window</em></strong> allows users to specify during what times is Kasten allowed to run the policy.
Enabling <strong><em>Use Staggering</em></strong> can intelligently distribute when to start policies during the specified window such that the desired frequency is maintained, but with the least amount of policies running simultaneously, allowing Kasten to reduce the peak load on the cluster.</p>
</div>
<div class="paragraph">
<p>These settings should be left unselected for this lab.</p>
</div>
</div>
</div>
</li>
<li>
<p>Toggle <strong><em>Enable Backups via Snapshot Exports</em></strong> and select <code>kastenbackups-user1</code> as the <strong><em>Export Location Profile</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/13.png" alt="13">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Kasten will export all data associated with the snapshot to ensure you have a durable, off-cluster copy.
However, there are circumstances where you may only want to export references to the snapshot, such as migrating a workload in AWS from one availability zone to another.
This ability to only export snapshot metadata can dramatically improve performance in these specific instances.
This can be configured under <strong><em>Advanced Export Settings</em></strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Under <strong><em>Select Applications</em></strong>, verify the <code>kasten-lab-user1</code> namespace has been selected.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/14.png" alt="14">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Targeting application(s) based on namespace is generally the most straightforward method of defining a backup policy.
However, Kasten also allows you to identify applications based on native Kubernetes labels.
This is especially helpful if you have many VMs in a single namespace and only want to protect current and <strong><em>future</em></strong> VMs with a specific label on the <code>VirtualMachine</code> resource, such as <code>backup: gold</code> or <code>vm: prod</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kasten also provides rich filtering capabilities to include or exclude resources based on Kubernetes <strong><em>API Group</em></strong>, <strong><em>API Version</em></strong>, <strong><em>Resource Type</em></strong>, <strong><em>Resource Name</em></strong>, and <strong><em>Labels</em></strong>.
For example, you could exclude backup for <strong><em>Secrets</em></strong> resources where a label includes an indication that the secret is externally managed.</p>
</div>
</div>
</div>
</li>
<li>
<p>Leave the remaining settings as default.</p>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When performing many tasks within the Kasten UI, you can press the <strong><em>&lt;/&gt; YAML</em></strong> button to expose the native Kubernetes YAML that defines the resource created through the UI.
This can be useful for familiarizing yourself with the Kubernetes-native APIs defined by Kasten and for extracting snippets for use in GitOps or Infrastructure-as-Code tools.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong><em>Create Policy</em></strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_freezing_the_guest_filesystem"><a class="anchor" href="#_5_freezing_the_guest_filesystem"></a>5. Freezing the Guest Filesystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kasten can freeze the guest filesystem before the snapshot and unfreeze after the snapshot completes by annotating the VirtualMachine resource with <code>k10.kasten.io/freezeVM=true</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Web Terminal</em></strong>, enable filesystem freezing for <code>fedora-k10</code>:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc annotate virtualmachine fedora-k10 \
  -n kasten-lab-user1 \
  k10.kasten.io/freezeVM=true</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The freeze and unfreeze operations will only be attempted if the VirtualMachine is in <strong><em>Running</em></strong> state.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Kasten defines a 5 minute default timeout for the snapshot operation to complete before aborting the snapshot operation and unfreezing the VM.
This can be overridden using the <code>kubeVirtVMs.snapshot.unfreezeTimeout</code> Helm/Operand parameter.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_6_running_the_policy"><a class="anchor" href="#_6_running_the_policy"></a>6. Running the Policy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rather than wait until the top of the hour for the policy to run, you can manually initiate a policy run programmatically or via the UI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong><em>Kasten Dashboard → Policies → Policies</em></strong>, click <strong><em>Run Once</em></strong> for the <code>kasten-lab-backup-user1</code> Policy.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/15.png" alt="15">
</div>
</div>
</li>
<li>
<p>Optionally, specify an expiration date for the manual backup and then click <strong><em>Yes, Continue</em></strong> to start the backup.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/16.png" alt="16">
</div>
</div>
</li>
<li>
<p>Select <strong><em>Dashboard</em></strong> from the sidebar.</p>
</li>
<li>
<p>Under <strong><em>Actions</em></strong>, select the <code>kasten-lab-backup-user1</code> Policy Run to monitor status.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/17.png" alt="17">
</div>
</div>
<div class="paragraph">
<p>Click into each individual <strong><em>Action</em></strong> to view to associated details, including YAML, a complete list of the application metadata and volume snapshots protected, and how much volume data was transferred by the Kasten datamover to the Location Profile.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/18.png" alt="18">
</div>
</div>
</li>
<li>
<p>Wait for the <strong><em>Policy Run</em></strong> to complete before proceeding. It should take less than 5 minutes for the backup to finish.</p>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If your policy fails, review the provided error message for further details.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/18b.png" alt="18b">
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_7_performing_a_local_restore"><a class="anchor" href="#_7_performing_a_local_restore"></a>7. Performing a Local Restore</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When performing an in-place restore on the application&#8217;s original cluster, choosing the local RestorePoint provides the most rapid recovery as it uses the snapshot data already present on primary storage, rather than having to depend on data which must be transferred from the remote repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Kasten Dashboard</em></strong>, select <strong><em>Applications</em></strong> from the sidebar.</p>
<div class="paragraph">
<p>You should observe that the <code>kasten-lab-user1</code> <strong><em>Status</em></strong> has changed to <strong><em>Compliant</em></strong>, indicating that the application is compliant with the backup SLA defined in the policy (i.e.
There is a backup for the application created within the last hour to satisfy the hourly policy frequency).</p>
</div>
</li>
<li>
<p>Under <code>kasten-lab-user1</code>, select <strong><em>&#8230;&#8203;
→ Restore</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/19.png" alt="19">
</div>
</div>
</li>
<li>
<p>Select the most recent RestorePoint, and click the local version as shown below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/20.png" alt="20">
</div>
</div>
<div class="paragraph">
<p>You should observe by default the selected RestorePoint includes all resources captured as part of the backup will be restored to its original namespace - with options to perform a more granular restore and/or modify the target namespace.</p>
</div>
</li>
<li>
<p>Keep the default settings and click <strong><em>Restore</em></strong> to begin a full, in-place restore.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/21.png" alt="21">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Kasten will terminate the running VM and overwrite the existing resources.
However, any resources in the namespace that do not exist in the RestorePoint will not be altered (protecting against unintentional data loss).
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Confirm the restore action by validating the application and click <strong><em>Restore</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/21a.png" alt="21a">
</div>
</div>
</li>
<li>
<p>Return to the <strong><em>Dashboard</em></strong> to monitor the status of the <strong><em>Restore</em></strong> under <strong><em>Actions</em></strong>.</p>
<div class="paragraph">
<p>You should expect this operation to complete rapidly (less than 2 minutes), as the VM volume is being restored from a local CSI VolumeSnapshot.</p>
</div>
</li>
<li>
<p>Once the <strong><em>Restore</em></strong> has completed, return to <strong><em>OpenShift Console → Virtualization → Virtual Machines</em></strong> and validate the <code>fedora-k10</code> VM is <strong><em>Running</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/22.png" alt="22">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also validate the source of the restored volume by running:
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe pvc fedora-k10 -n kasten-lab-user1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should observe the volume&#8217;s <strong><em>DataSource</em></strong> is a <code>k10-csi-snap-...</code> VolumeSnapshot, confirming the volume was restored from a local snapshot.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_performing_a_remote_restore"><a class="anchor" href="#_8_performing_a_remote_restore"></a>8. Performing a Remote Restore</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often, local snapshot data may not be available, requiring that data be restored from the remote Kasten repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong><em>Web Terminal</em></strong>, run the following to delete the <code>kasten-lab-user1</code> namespace:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete virtualmachine fedora-k10 -n kasten-lab-user1

oc delete project kasten-lab-user1</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<em>"Snapshots are not backup."</em>              ~ Mark Twain
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>VolumeSnapshots are namespaced resources.
Removing the <code>kasten-lab-user1</code> namespace will delete the VolumeSnapshots associated with your local RestorePoints.
Additionally, the <code>ocs-storagecluster-rbdplugin-snapclass</code> VolumeSnapshotClass sets <code>deletionPolicy: Delete</code> by default, meaning that deletion of the VolumeSnapshot resource results in the removal of the snapshot within Ceph.</p>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong><em>Kasten Dashboard</em></strong>, select <strong><em>Applications</em></strong> from the sidebar.</p>
<div class="paragraph">
<p>You should observe that <code>kasten-lab-user1</code> no longer appears in the list of applications as the namespace no longer exists on the cluster.</p>
</div>
</li>
<li>
<p>Click the <strong><em>All</em></strong> dropdown menu and select <strong><em>Removed</em></strong> to view the list of non-existent namespaces with available RestorePoints.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/23.png" alt="23">
</div>
</div>
</li>
<li>
<p>Under <code>kasten-lab-user1</code>, select <strong><em>&#8230;&#8203;
→ Restore</em></strong>.</p>
</li>
<li>
<p>Select the most recent RestorePoint, and click the <strong><em>EXPORTED</em></strong> version as shown below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/24.png" alt="24">
</div>
</div>
</li>
<li>
<p>Under <strong><em>Application Name</em></strong>, click <strong><em>+ Create New Namespace</em></strong>.</p>
</li>
<li>
<p>Specify <code>kasten-lab-clone-user1</code> as the <strong><em>New Namespace</em></strong> and click <strong><em>Create</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/25.png" alt="25">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure to click the green <strong><em>Create</em></strong> button to create the new namespace!
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong><em>Restore</em></strong>, then in the confirmation dialog click <strong><em>Restore</em></strong> again.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/25a.png" alt="25a">
</div>
</div>
</li>
<li>
<p>Return to the <strong><em>Dashboard</em></strong> to monitor progress under <strong><em>Actions</em></strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/26.png" alt="26">
</div>
</div>
</li>
<li>
<p>Return to <strong><em>OpenShift Console → Virtualization → VirtualMachines</em></strong> and observe the <code>fedora-k10</code> VirtualMachine now running in the <code>kasten-lab-clone-user1</code> namespace.</p>
<div class="imageblock">
<div class="content">
<img src="_images/module01-lab03-backup_restore/27.png" alt="27">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike the local restore, the PVC populated by the Kasten datamover will not contain a <strong><em>DataSource</em></strong> snapshot reference:
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe pvc fedora-k10 -n kasten-lab-clone-user1</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_9_takeaways"><a class="anchor" href="#_9_takeaways"></a>9. Takeaways</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Congratulations on having protected and restored your first workload using Veeam Kasten!</em> Below are some of the key takeaways of what has been covered in the lab so far:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kasten runs on the cluster and can be deployed via OperatorHub or Helm chart</p>
</li>
<li>
<p>Kasten supports multiple authentication options (Tokens, OIDC, LDAP, OpenShift OAuth) and Kubernetes-native RBAC for controlling access and providing per-namespace self-service</p>
</li>
<li>
<p>Kasten can backup data to S3, Azure Blob, Google Cloud Storage, NFS, and Veeam Backup &amp; Replication</p>
</li>
<li>
<p>Immutable backup support prevents unintended or malicious attempts to delete backup data, providing critical protection against ransomware</p>
</li>
<li>
<p><code>Block</code> mode volumes can provide <code>ReadWriteMany</code> access using Ceph RBD, the most performant option for enabling Live Migration of OpenShift Virtual Machines</p>
</li>
<li>
<p>Kasten performs always incremental backups with support for both <code>Filesystem</code> and <code>Block</code> mode volumes</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="module01-lab02-location-profile.html" class="query-params-link">Configuring Veeam Kasten for Backups</a></span>
  <span class="next"><a href="module01-lab04-multicluster.html" class="query-params-link">Configuring Multi-Cluster</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
